# My project's README

This code takes a list of spectra gathered with HARPS/HARPS-N, shift them in the stellar reference frame using either the RVs computed by the DRS or user-provided values, and coadd them into a linearly-spaced wavelength scale. 

### Download the correct files

To perform the coadding, you need:
- the `e2ds` file (order-by-order spectrum)
- the `blaze` file obtained at the beginning of the night
- the `ccf` file, as we need thr RV of the star and the BERV correction to shift the `e2ds` spctrum into the stellar reference frame

The `blaze` function can be downloaded from the ESO archive through a different interface. Pay attention to the following points:
- Calibration files are not associated to the observations carried during the night, in the sense that they will not show up in the archive when searching for your targets. 
- The scientific `e2ds` file reports the name of the associated `blaze` file in the header. This keyword is used by this code to associate the correct blaze file to the observation. 


### Prepare the input file lsit


To run the code for the spectral coadding, you first need to prepare an `input filelist` following this format:

```
2024-06-22    HARPS.2024-06-22T23_41_06.544   G2   A   TOI0000
2024-06-30    HARPS.2024-07-01T03_12_44.661   G2   A   TOI0000
2024-07-01    HARPS.2024-07-02T02_55_22.043   G2   A   TOI0000
``` 

**Note** the first column corresponds to the date at the beginning of  the night. The root of the raw file name will report the date of the at the beginning of the observations

### Run the code 

Running the code without arguments will return a short manual:
```bash
/home/malavolta/CODE/HARPSN_tools/harps_fits_coaddspectra_e2ds.e
``` 

```
 Input 1: input file list
 Input 2: ouput rad name
 Input 3: rebinning step
 Input 4: 1: extensive output files
 Input 5: (optional) 1: RV in input file list as 6th argument
 Input 6: (optional) Calibration directory (blaze, etc)
 Input 7: (optional) 0 = do not use date as prefix for calibration (default is 1)
 Input 8: (optional) Archive directory (e2ds, ccf, etc) (default is Input 6)
 Input 9: (optional) 0 = do not use date as prefix for Archive directory (default is Input 7)

 Input 7 and 8 to be used if all the files are in the same directory (as Yabi reprocessed files are)
 If Input 6 and 7 are specified, but 8 and 9 are not, then the same of 6 and 7 will be applied
```


- **Input 1**: relative path and name of the input file list.
- **Input 2**: output base for the name of the output files. You can specify relative path, but the path must exist before running the code.
- **Input 3**: rebinning steps: the average wavelength step of HARPS/HARPS-N is 0.016 Angstrom.
- **Input 4**: in addition to the standard output, additional (lenghty) files will be save. Use this option only if you nitice something strange in your coadded file. 
- **Input 5**: if **1**, the code will use user-provided RVs provided as the 6th column of the configuration file. Use this option only if you think that RV from DRS may not be reliable (Early type stars, fast rotators...).
- **Input 6**: Specify the directory where the *calibration* files are stored
- **Input 7**: if **1**, the code will search the blaze file in the subdirectory with the same name as the date specified in the input filelist (first column). Use **0** if all the blaze files are mized together in the same folder
- **Input 8**: specify the directory where the *scientific* files are stored.
- **Input 9**: as *Input 7*, this time for the scinetific frames. 


Note: 
- You cannot use a specific option (e.g. Input 8) without specifying all the previous options
- The code will not overwrite files: you have to delete the files generated by the last run before tunning it again 
- The code will not make new directories: if you specify a path for **Input 2**, be sure that the path exists. 
- If `Input 6` is not specified, the default folder will be `/home/malavolta/data/HARPS/data/`

Examples:

If all the files are in the same folders and you wasnt to save the output in the same folder, just run:

```bash
/home/malavolta/CODE/HARPSN_tools/harps_fits_coaddspectra_e2ds.e TOI000_input.list coadd/TOI0000_coadd 0.02  1 0  . 0  . 0 
```

You can specify the relative path of your data:

```bash
/home/malavolta/CODE/HARPSN_tools/harps_fits_coaddspectra_e2ds.e TOI5795_input.list coadd/TOI0000_coadd 0.02  1 0  ~/data/COADD/spectra  0  ~/data/COADD/spectra  0
```

If the observations are divided according to the night of observations, as it usually happens when you download the data from the ESO archive, the last command will change in this way:

```bash
/home/malavolta/CODE/HARPSN_tools/harps_fits_coaddspectra_e2ds.e TOI5795_input.list coadd/TOI0000_coadd 0.02  1 0  ~/data/COADD/spectra  1  ~/data/COADD/spectra  1
```